<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
 PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Signalbox</title>
    <style type="text/css">
      form.signalheadcontrol { border-style: solid;
			       padding: 1em; }
    </style>
    <script type="text/javascript">
      function SetSignal(id) {
	  console.log(id);

	  var responseId = "response"+id;
	  
	  var flashId = "flashing"+id;
	  var flashing = document.getElementById(flashId);
	  var flash = "Steady";
	  if( flashing.checked ) {
	      flash = "Flashing";
	  }
	  console.log(flash);

	  var aspectId = "aspect"+id;
	  var query = "input[name = '" + aspectId + "']:checked";
	  var aspect = document.querySelector(query).value;
	  console.log(aspect);

	  var xhr = new XMLHttpRequest();
          xhr.open("post", '/rpc');
          // Required by JSON-RPC over HTTP
          xhr.setRequestHeader("Content-Type","application/json");
	  
          // It is better to use real formatter like JSON.js
          var request = '{ ';
	  request += '"method": "setsignalhead", ';
	  request += '"params": [ "' + id + '", "' + aspect +'", "' + flash +'"]';
	  request += ', "id": 1 }';
	  console.log(request);

	  xhr.onreadystatechange = function() {
              if (xhr.readyState === 4) {
                  var res;
                  if(xhr.status === 200) {
                      // Don't call eval in real code use some parser
		      console.log("Response = " + xhr.responseText);
                      var result = JSON.parse(xhr.responseText);
		      console.log("Result = " + result.result);
		      console.log("Error = " + result.error);
                      if(result.error==null) {
                          res = JSON.stringify(result.result);
                      }
                      else {
                          res = result.error;
                      }
                  }
                  else {
                      res = 'Invalid Status ' + xhr.status;
                  }
                  document.getElementById(responseId).innerHTML = res;
              }
          }
          xhr.send(request); 
	  
	  return false;
      }
    </script>
  </head>
  <body>
    <form id="ID00:00:00:01"
	  class="signalheadcontrol"
	  action=""
	  onsubmit="return SetSignal('00:00:00:01');" >
      <h1>SignalHead 00:00:00:01</h1>
      <p>
	<input type="radio" name="aspect00:00:00:01"
	       value="Red"
	       id="red00:00:00:01" 
	       checked="checked" />
	<label for="red00:00:00:01">Red</label>
	<input type="radio" name="aspect00:00:00:01"
	       value="Yellow"
	       id="yellow00:00:00:01" />
	<label for="yellow00:00:00:01">Yellow</label>
	<input type="radio" name="aspect00:00:00:01"
	       value="DoubleYellow"
	       id="doubleyellow00:00:00:01" />
	<label for="doubleyellow00:00:00:01">Double Yellow</label>
	<input type="radio" name="aspect00:00:00:01"
	       value="Green"
	       id="green00:00:00:01" />
	<label for="green00:00:00:01">Green</label>
      </p>
      <p>
	<input type="checkbox" name="flash"
	       value="flashing"
	       id="flashing00:00:00:01" />
	<label for="flashing00:00:00:01">Flashing</label>
      </p>
      <p>
	<input type="submit" value="Submit" />
      </p>
      <p id="response00:00:00:01" />
    </form>
  </body>
</html>
